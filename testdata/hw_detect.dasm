; hw_detect finds a specific hardware device index
; based on the device ID you specify in registers
; A and B. It returns the device index in A.
; A will be -1 if the device was not found.
:hw_detect
  set i, a
  set j, b
  hwn z
  sub z, 1

:hw_detect_loop
  hwq z

  ife a, i
    ife b, j
      set pc, hw_detect_ret

  sub z, 1
  ifg z, 0
    set pc, hw_detect_loop

:hw_detect_ret
  set a, z
  set pc, pop

