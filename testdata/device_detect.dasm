; device_index device_detect( device_id )
;
; This finds a specific hardware device index
; based on the device ID you specify in registers A and B.
;
; It returns the device index in A.
; A will be -1 if the device was not found.


:device_detect
set i,  a; line comment
SET j,  B
hwn z
sub Z,  1
; Some comment on block
:device_detect_loop
HWQ Z
ife a,  i
IFE b,  j
set pc, device_detect_ret
sub z,  1
ifa z   ,0xffff
set pc, device_detect_loop
:device_detect_ret
set a,  z
set PC, POP
