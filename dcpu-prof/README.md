## DCPU Profiler

**Note**: This is work in progress. I hope to expand the amount of data about
a program one can query along with ways to make it more useful.

This is an interactive commandline tool that can analyze profiling data
generated by the `prof` package.

it accepts a number of textual commands which serve to display various
types of data in tabular form. Options to these commands allow us to
sort the data in different ways.

### Usage

Read the given file:

    $ dcpu-prof data.prof

Run the program with the `-h` flag for a listing of all options.


### Example

Here is an excerpt of an example usage:

	$ dcpu-prof testdata/test.prof 
	dcpu-prof 0.1.1342027356 (Go runtime go1.0.2).
	Copyright (c) 2010-2012, Jim Teeuwen.
	Press 'q' to exit and 'help' for help.
    
	top
		       COUNT | COST |       CUM. COST |                 FILE | SOURCE
	============================================================================
		   8 (0.12%) |    2 |      23 (0.16%) |       memchr.dasm:19 | ife [a], b
		   7 (0.10%) |    2 |      20 (0.14%) |       memchr.dasm:22 | ife c, 0
		   7 (0.10%) |    2 |      14 (0.10%) |       memchr.dasm:21 | sub c, 1
		   6 (0.09%) |    2 |      12 (0.08%) |       memchr.dasm:24 | add a, 1
		   6 (0.09%) |    2 |      12 (0.08%) |       memchr.dasm:25 | set pc ,memchr_loop
		   3 (0.04%) |    3 |      11 (0.08%) |       memchr.dasm:15 | ife 0, c ; num is zero -- No compare needed.
		   2 (0.03%) |    2 |       6 (0.04%) |     assert_eq.dasm:8 | ifn a, b
		   2 (0.03%) |    1 |       2 (0.01%) |    assert_eq.dasm:10 | set pc, pop
		   1 (0.01%) |    2 |       2 (0.01%) |        _test.dasm:30 | exit
		   1 (0.01%) |    2 |       2 (0.01%) |        _test.dasm:17 | jsr assert_ez

	top 3 cumulative 
		       COUNT | COST |       CUM. COST |                 FILE | SOURCE
	============================================================================
		   8 (0.12%) |    2 |      23 (0.16%) |       memchr.dasm:19 | ife [a], b
		   7 (0.10%) |    2 |      20 (0.14%) |       memchr.dasm:22 | ife c, 0
		   7 (0.10%) |    2 |      14 (0.10%) |       memchr.dasm:21 | sub c, 1

	top 3 count
		       COUNT | COST |       CUM. COST |                 FILE | SOURCE
	============================================================================
		   8 (0.12%) |    2 |      23 (0.16%) |       memchr.dasm:19 | ife [a], b
		   7 (0.10%) |    2 |      20 (0.14%) |       memchr.dasm:22 | ife c, 0
		   7 (0.10%) |    2 |      14 (0.10%) |       memchr.dasm:21 | sub c, 1

	top 3 cost
		       COUNT | COST |       CUM. COST |                 FILE | SOURCE
	============================================================================
		   3 (0.04%) |    3 |      11 (0.08%) |       memchr.dasm:15 | ife 0, c ; num is zero -- No compare needed.
		   1 (0.01%) |    2 |       2 (0.01%) |         _test.dasm:3 | set a, data
		   1 (0.01%) |    2 |       2 (0.01%) |         _test.dasm:9 | jsr assert_eq


In this example, the table shows 5 fields:

* **COUNT**: This is the total number of times the particular instruction
  was executed.
  
* **COST**: This is the cpy cycle cost for 1 single execution of this
  instruction. It includes the cost for the operands.
  
* **CUM. COST**: This is the total (cumulative) cost incurred by this
  instruction over the entire runtime of the program. It is not simply a
  matter of COUNT*COST, but it additionally holds penalty costs which may have
  been incurred in particular situations. Most notably this applies to skipped
  branch instructions. The SPEC notes that these always incur a penalty of X
  cycles for each skipped branch.
  
* **FILE**: This is the file name and line number from which the particular
  instruction originated.
  
* **SOURCE**: This shows the original source line from which this instruction'
  was generated.


### Dependencies

* github.com/jteeuwen/dcpu/cpu
* github.com/jteeuwen/dcpu/prof


### License

DCPU, 0x10c and related materials are Copyright 2012 Mojang.

Unless otherwise stated, all of the work in this project is subject to a
1-clause BSD license. Its contents can be found in the enclosed LICENSE file.
